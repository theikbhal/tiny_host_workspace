<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Habit Tracker</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        bg: '#050505',
                        card: '#141414',
                        cardHover: '#1A1A1A',
                        subtext: '#525252',
                        textMain: '#FFFFFF',
                        accent: '#3B82F6', 
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #050505;
            color: #ffffff;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Hide scrollbar for clean look but allow scrolling */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Habit Grid Animation */
        .habit-cell {
            transition: all 0.2s ease;
        }
        .habit-cell:active {
            transform: scale(0.9);
        }

        /* Floating Action Button Pulse */
        @keyframes pulse-soft {
            0% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.1); }
            70% { box-shadow: 0 0 0 10px rgba(255, 255, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); }
        }
        .fab-btn {
            animation: pulse-soft 2s infinite;
        }
    </style>
</head>
<body class="h-screen w-full overflow-hidden flex flex-col items-center justify-center font-sans">

    <!-- Mobile Container (Simulates App View on Desktop) -->
    <div class="w-full h-full max-w-md bg-bg flex flex-col relative shadow-2xl overflow-hidden md:border md:border-gray-800 md:rounded-3xl md:h-[90vh]">
        
        <!-- Header -->
        <header class="pt-8 pb-4 px-6 flex justify-between items-end bg-bg z-10 sticky top-0">
            <div>
                <p class="text-subtext text-sm font-semibold uppercase tracking-wider mb-1" id="currentDate">TODAY</p>
                <h1 class="text-3xl font-extrabold tracking-tight">Habits</h1>
            </div>
            <button onclick="toggleSettings()" class="text-subtext hover:text-white transition-colors p-2">
                <i class="fa-solid fa-gear text-xl"></i>
            </button>
        </header>

        <!-- Main Content (Habit List) -->
        <main class="flex-1 overflow-y-auto no-scrollbar px-4 pb-24" id="habitList">
            <!-- Habits will be injected here via JS -->
            <div class="flex flex-col items-center justify-center h-64 text-subtext opacity-50 mt-10">
                <i class="fa-solid fa-layer-group text-4xl mb-4"></i>
                <p>No habits yet. Start small.</p>
            </div>
        </main>

        <!-- Floating Action Button (Add) -->
        <button onclick="openModal()" class="fab-btn absolute bottom-24 right-6 w-14 h-14 bg-white text-black rounded-full shadow-lg flex items-center justify-center text-2xl hover:scale-105 transition-transform z-20">
            <i class="fa-solid fa-plus"></i>
        </button>

        <!-- Bottom Navigation -->
        <nav class="h-20 bg-card/80 backdrop-blur-md border-t border-gray-900 flex justify-around items-center px-2 pb-2 absolute bottom-0 w-full z-10">
            <button class="nav-item flex flex-col items-center justify-center w-full h-full text-white" onclick="switchTab('home')">
                <i class="fa-solid fa-house mb-1 text-xl"></i>
                <span class="text-[10px] font-medium">Home</span>
            </button>
            <button class="nav-item flex flex-col items-center justify-center w-full h-full text-subtext hover:text-gray-300" onclick="switchTab('stats')">
                <i class="fa-solid fa-chart-simple mb-1 text-xl"></i>
                <span class="text-[10px] font-medium">Insights</span>
            </button>
        </nav>

        <!-- Add Habit Modal -->
        <div id="addModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-end sm:items-center justify-center">
            <div class="bg-card w-full max-w-md p-6 rounded-t-3xl sm:rounded-3xl shadow-2xl transform transition-transform duration-300 translate-y-full" id="modalContent">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold">New Habit</h2>
                    <button onclick="closeModal()" class="text-subtext hover:text-white"><i class="fa-solid fa-xmark text-xl"></i></button>
                </div>

                <div class="space-y-5">
                    <!-- Name Input -->
                    <div>
                        <label class="block text-xs text-subtext font-bold uppercase tracking-wider mb-2">Name</label>
                        <input type="text" id="habitName" placeholder="e.g. Read 10 pages" class="w-full bg-bg border border-gray-800 rounded-xl p-4 text-white placeholder-gray-700 focus:outline-none focus:border-white transition-colors">
                    </div>

                    <!-- Color Picker -->
                    <div>
                        <label class="block text-xs text-subtext font-bold uppercase tracking-wider mb-2">Color</label>
                        <div class="flex gap-3 overflow-x-auto no-scrollbar py-1" id="colorPicker">
                            <!-- Colors generated by JS -->
                        </div>
                    </div>

                    <!-- Icon Picker -->
                    <div>
                        <label class="block text-xs text-subtext font-bold uppercase tracking-wider mb-2">Icon</label>
                        <div class="grid grid-cols-6 gap-2" id="iconPicker">
                            <!-- Icons generated by JS -->
                        </div>
                    </div>

                    <button onclick="saveHabit()" class="w-full bg-white text-black font-bold py-4 rounded-xl mt-4 hover:bg-gray-200 transition-colors">
                        Create Habit
                    </button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- State Management ---
        const STORAGE_KEY = 'habitkit_clone_data';
        
        let habits = [];
        
        // Colors mimicking HabitKit
        const colors = [
            '#ef4444', // Red
            '#f97316', // Orange
            '#eab308', // Yellow
            '#22c55e', // Green
            '#06b6d4', // Cyan
            '#3b82f6', // Blue
            '#a855f7', // Purple
            '#ec4899', // Pink
        ];

        // Simple FontAwesome icons
        const icons = [
            'fa-book', 'fa-droplet', 'fa-person-running', 'fa-dumbbell', 
            'fa-bed', 'fa-apple-whole', 'fa-laptop-code', 'fa-pen', 
            'fa-guitar', 'fa-money-bill', 'fa-bicycle', 'fa-brain'
        ];

        let selectedColor = colors[5]; // Default Blue
        let selectedIcon = icons[0];

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            updateDateHeader();
            renderHabits();
            setupModal();
        });

        function loadData() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                habits = JSON.parse(stored);
            } else {
                // Default starter habit
                habits = [{
                    id: Date.now(),
                    name: 'Drink Water',
                    color: '#3b82f6',
                    icon: 'fa-droplet',
                    completedDates: {} // Format: "YYYY-MM-DD": true
                }];
                saveData();
            }
        }

        function saveData() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(habits));
            renderHabits();
        }

        function updateDateHeader() {
            const date = new Date();
            const options = { weekday: 'long', month: 'short', day: 'numeric' };
            document.getElementById('currentDate').textContent = date.toLocaleDateString('en-US', options);
        }

        // --- Rendering Logic ---
        function renderHabits() {
            const container = document.getElementById('habitList');
            container.innerHTML = '';

            if (habits.length === 0) {
                container.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-64 text-subtext opacity-50 mt-10">
                        <i class="fa-solid fa-layer-group text-4xl mb-4"></i>
                        <p>No habits yet. Start small.</p>
                    </div>`;
                return;
            }

            habits.forEach(habit => {
                const streak = calculateStreak(habit.completedDates);
                const heatmapHTML = generateHeatmap(habit);
                
                const card = document.createElement('div');
                card.className = 'bg-card p-4 rounded-2xl mb-4 border border-transparent hover:border-gray-800 transition-all';
                card.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-xl bg-gray-800 flex items-center justify-center text-xl" style="color: ${habit.color}">
                                <i class="fa-solid ${habit.icon}"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-lg leading-tight">${habit.name}</h3>
                                <p class="text-xs text-subtext font-medium">${streak} day streak</p>
                            </div>
                        </div>
                        <button onclick="deleteHabit(${habit.id})" class="text-gray-800 hover:text-red-500 transition-colors">
                            <i class="fa-solid fa-trash text-sm"></i>
                        </button>
                    </div>
                    <!-- Contribution Grid -->
                    <div class="grid grid-cols-10 gap-1.5">
                        ${heatmapHTML}
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function generateHeatmap(habit) {
            let html = '';
            // Show last 20 days (2 rows of 10)
            const daysToShow = 20; 
            const today = new Date();
            
            // We want to show from (today - 19) to (today)
            // We iterate backwards from today
            let days = [];
            for (let i = daysToShow - 1; i >= 0; i--) {
                const d = new Date();
                d.setDate(today.getDate() - i);
                days.push(d);
            }

            days.forEach(date => {
                const dateStr = formatDate(date);
                const isCompleted = habit.completedDates[dateStr];
                const isToday = dateStr === formatDate(new Date());
                
                // Style logic
                let bgClass = 'bg-[#262626]'; // Empty state dark grey
                let opacity = 'opacity-100';
                
                if (isCompleted) {
                    // We use inline style for dynamic colors, but base class for shape
                    // This specific rendering uses the habit color directly
                }
                
                // Add a border for today if not done
                const borderStyle = (isToday && !isCompleted) ? 'border border-gray-600' : '';
                const bgStyle = isCompleted ? `background-color: ${habit.color}` : '';

                html += `
                    <div 
                        onclick="toggleHabitStatus(${habit.id}, '${dateStr}')"
                        class="habit-cell aspect-square rounded-md cursor-pointer ${bgClass} ${borderStyle}" 
                        style="${bgStyle}"
                        title="${dateStr}"
                    ></div>
                `;
            });
            
            return html;
        }

        // --- Actions ---
        function toggleHabitStatus(habitId, dateStr) {
            const habit = habits.find(h => h.id === habitId);
            if (habit) {
                if (habit.completedDates[dateStr]) {
                    delete habit.completedDates[dateStr];
                } else {
                    habit.completedDates[dateStr] = true;
                    triggerConfetti(dateStr); // Only simple vibration logic here
                }
                saveData();
            }
        }

        function deleteHabit(id) {
            if(confirm('Delete this habit?')) {
                habits = habits.filter(h => h.id !== id);
                saveData();
            }
        }

        function calculateStreak(datesObj) {
            let streak = 0;
            const today = new Date();
            
            // Check today first
            if (datesObj[formatDate(today)]) {
                streak++;
            }
            
            // Check previous days
            while (true) {
                const d = new Date();
                d.setDate(today.getDate() - (streak + (datesObj[formatDate(today)] ? 0 : 1))); // complex logic to handle if today is missing but streak was active yesterday
                // Simplify: just check backwards from yesterday if today is not done, or from today if it is.
                
                // Simpler streak logic:
                // If today is checked, start from today-1. If today is NOT checked, start from yesterday.
                // Actually, let's just count backwards from yesterday. If today is done, add 1.
                break; 
            }

            // Robust consecutive count
            let currentCheck = new Date();
            let count = 0;
            
            // Check if today is done.
            if (datesObj[formatDate(currentCheck)]) {
                count++;
            } else {
                // If today is not done, streak might still be alive from yesterday
            }
            
            // Look back from yesterday
            currentCheck.setDate(currentCheck.getDate() - 1);
            while (datesObj[formatDate(currentCheck)]) {
                count++;
                currentCheck.setDate(currentCheck.getDate() - 1);
            }
            
            return count;
        }

        function formatDate(date) {
            return date.toISOString().split('T')[0];
        }

        // --- Modal Logic ---
        function setupModal() {
            // Render Colors
            const colorContainer = document.getElementById('colorPicker');
            colorContainer.innerHTML = colors.map(c => `
                <div onclick="selectColor('${c}')" class="w-10 h-10 rounded-full flex-shrink-0 cursor-pointer border-2 ${selectedColor === c ? 'border-white' : 'border-transparent'}" style="background-color: ${c}"></div>
            `).join('');

            // Render Icons
            const iconContainer = document.getElementById('iconPicker');
            iconContainer.innerHTML = icons.map(i => `
                <div onclick="selectIcon('${i}')" class="w-10 h-10 rounded-xl bg-bg flex items-center justify-center cursor-pointer border-2 ${selectedIcon === i ? 'border-white text-white' : 'border-gray-800 text-subtext'}">
                    <i class="fa-solid ${i}"></i>
                </div>
            `).join('');
        }

        function selectColor(color) {
            selectedColor = color;
            setupModal(); // Re-render to show selection
        }

        function selectIcon(icon) {
            selectedIcon = icon;
            setupModal(); // Re-render to show selection
        }

        function openModal() {
            document.getElementById('addModal').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('modalContent').classList.remove('translate-y-full');
            }, 10);
            document.getElementById('habitName').focus();
        }

        function closeModal() {
            document.getElementById('modalContent').classList.add('translate-y-full');
            setTimeout(() => {
                document.getElementById('addModal').classList.add('hidden');
            }, 300);
            // Reset fields
            document.getElementById('habitName').value = '';
        }

        function saveHabit() {
            const name = document.getElementById('habitName').value.trim();
            if (!name) return alert('Please enter a name');

            const newHabit = {
                id: Date.now(),
                name: name,
                color: selectedColor,
                icon: selectedIcon,
                completedDates: {}
            };

            habits.push(newHabit);
            saveData();
            closeModal();
        }

        function switchTab(tab) {
            if(tab === 'stats') {
                alert('Insights coming soon in Pro version! (Just kidding, this is a static demo)');
            }
        }
        
        function toggleSettings() {
             alert('Settings clicked. Here you would toggle Dark/Light mode, import/export data, etc.');
        }

        function triggerConfetti(dateStr) {
             // Basic haptic feedback check for mobile
             if (navigator.vibrate) {
                 navigator.vibrate(50);
             }
        }

    </script>
</body>
</html>